version: '3.3'

networks:
  inventare:
    driver: bridge

services:
  database:
    image: mariadb
    volumes:
      - ./database/:/var/lib/mysql
    networks:
      - inventare
    environment:
      MYSQL_DATABASE: inventare
      MYSQL_ROOT_PASSWORD: root

  admin_migration:
    build: ./packages/core/admin/
    command: python manage.py migrate --noinput
    volumes:
      - ./packages/core/admin:/app/
    networks:
      - inventare
    environment:
      - SQL_ENGINE=django.db.backends.mysql
      - SQL_DATABASE=inventare
      - SQL_USER=root
      - SQL_PASSWORD=root
      - SQL_HOST=database
      - SQL_PORT=3306
    depends_on:
      - database

  admin:
    build: ./packages/core/admin/
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - ./packages/core/admin:/app/
    networks:
      - inventare
    ports:
      - 8000:8000
    environment:
      - SQL_ENGINE=django.db.backends.mysql
      - SQL_DATABASE=inventare
      - SQL_USER=root
      - SQL_PASSWORD=root
      - SQL_HOST=database
      - SQL_PORT=3306
      - DEBUG=true
    depends_on: 
      - database
      - admin_migration

  client:
    build: ./packages/core/client/
    volumes:
      - ./packages/core/client/src:/app/src/
      - ./packages/core/client/public:/app/public/
    networks:
      - inventare
    ports:
      - 3000:3000
    depends_on:
      - admin
